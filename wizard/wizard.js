define("wizard",["SensorWidget","SOS","jquery","moment","daterangepicker","jquery-ui","bootstrap"],function(e,t,a,r){"use strict";function n(){var e=["bearing","gauge","jqgrid","map","panel","progressbar","table","thermometer","timechart","windrose"],t=["default","primary","success","info","warning","danger"],r="";for(var n in e){var i=e[n],s=t[n%t.length];r+='<a role="button" class="menu-btn btn btn-'+s+' btn-lg" id="'+i+'"><div class="flaticon-'+i+'"></div>'+g(i)+"&nbsp;&nbsp;»</a>"}document.getElementById("main-menu").innerHTML=r,a(".menu-btn").click(function(){o(this.id)})}function i(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function o(t){a("#widget-form-title").html(g(t)+" Widget Configuration"),new e(t).inspect(function(e,r,n){var i,o,u,v,b="<fieldset><legend>Mandatory inputs</legend>";for(var h in e){switch(i=e[h],o="",u=g(i),v="",i){case"service":case"offering":case"feature":case"property":o='<select class="form-control" id="'+i+'"></select>';break;case"features":case"properties":o='<select class="form-control" multiple id="'+i+'"></select>',u+=" (multiselect)";break;case"refresh_interval":var y=[5,10,30,60,120];for(var w in y){var k=y[w];v+='<option id="'+k+'">'+k+"</option>"}o='<select class="form-control" id="'+i+'">'+v+"</select>";break;case"time_start":a.inArray("time_end",e)&&(u="Time Range (UTC)",o='<input class="form-control" type="text" id="time_range" disabled />');break;case"time_end":break;default:o='<input class="form-control" type="text" value="" id="'+i+'"/>'}o&&(b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+i+'">'+u+'</label><div class="col-lg-8">'+o+"</div></div>")}b+="</fieldset>",b+="<fieldset><legend>Optional inputs</legend>";for(h in r){switch(i=r[h],o="",u=g(i),v="",i){case"footnote":o='<textarea class="form-control" value="" id="'+i+'"></textarea>';break;case"base_map":for(var z in e.base_maps)v+='<option id="'+z+'">'+z+"</option>";o='<select class="form-control" id="'+i+'">'+v+"</select>";break;default:o='<textarea class="form-control" value="" id="'+i+'"></textarea>'}b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+i+'">'+u+'</label><div class="col-lg-8">'+o+"</div></div>"}b+="</fieldset>",b+="<fieldset><legend>Widget dimensions</legend>",i="sizes",u="Initial Size";for(h in n){var D=n[h];v+='<option id="size" value="'+h+'">'+D.w+" x "+D.h+" px</option>"}var T='<select class="form-control" id="sizes">'+v+"</select>";b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+i+'">'+u+'</label><div class="col-lg-8">'+T+"</div></div>",b+="</fieldset>",b+='<input type="button" name="build" class="btn btn-primary pull-right" value="Create Widget&nbsp;&nbsp;»"/>',a("#widget-form").html(b),a('[name="build"]').data({name:t,inputs:e,optionalInputs:r,preferredSizes:n}).click(f),s(["http://demo.geomati.co/sos/json","http://sensors.portdebarcelona.cat/sos/json","/52n-sos/sos/json"]),a("#service").change(function(){m();var e=a("#service").find("option:selected").attr("id");c(e)}),a("#offering").change(function(){var e=a("#offering").find("option:selected").data("procedure");l(e),d(e)}),a("#feature").change(function(){p()}),a("#features").change(function(){p()}),a("#property").change(function(){p()}),a("#properties").change(function(){p()})})}function s(e){var t=a("#service");if(e&&t){t.append(a("<option>").append("Select a Service..."));for(var r in e){var n=e[r];t.append(a("<option>").attr("id",n).append(n))}}}function c(e){u("#offering","#property","#properties","#feature","#features"),e&&(a("#offering").append(a("<option>").append("Select an Offering...")),t.setUrl(e),t.getCapabilities(function(e){for(var t in e){var r=e[t];a("#offering").append(a("<option>").attr("id",r.identifier).data("procedure",r.procedure[0]).append(r.name))}},m))}function d(e){u("#property","#properties"),e&&t.describeSensor(e,function(e){var t=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;t=t instanceof Array?t:[t];for(var r in t){var n=t[r],i=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];for(var o in i){var s=i[o];n.hasOwnProperty(s)&&(n.type=s,n.id=n[s].definition,n.description=n.name+" ("+s,"Quantity"==s&&n[s].hasOwnProperty("uom")&&(n.description+=" ["+n[s].uom.code+"]"),n.description+=")")}a("#property, #properties").append(a("<option>").attr("id",n.id).append(n.description))}},m)}function l(e){u("#feature","#features"),e&&t.getFeatureOfInterest(e,function(e){for(var t in e){var r=e[t],n=r.identifier.value,i=r.name.value;a("#feature, #features").append(a("<option>").attr("id",n).append(i))}},m)}function p(){var e=a("#time_range");if(e.length){var n=a("#offering").find("option:selected").data("procedure"),i=a("#feature").find("option:selected").attr("id"),o=a("#property").find("option:selected").attr("id"),s=i?i:a("#features").find("option:selected").map(function(){return this.id}).get(),c=o?o:a("#properties").find("option:selected").map(function(){return this.id}).get();t.getDataAvailability(n,s,c,function(t){for(var a,n,i=t[0].phenomenonTime[0],o=t[0].phenomenonTime[1],s=1;s<t.length;s++)a=t[s].phenomenonTime[0],n=t[s].phenomenonTime[1],i>a&&(i=a),n>o&&(o=n);var c,d={timePicker:!0,format:"MMM D, YYYY H:mm",timePickerIncrement:5,timePicker12Hour:!1,timePickerSeconds:!1,timeZone:"+00:00",minDate:r.utc(i),maxDate:r.utc(o),dateLimit:{days:7},ranges:{Today:[r().startOf("day"),r()],"Last hour":[r().subtract(1,"hour"),r()],"Last 3 hours":[r().subtract(3,"hours"),r()],"Last 6 hours":[r().subtract(6,"hours"),r()],"Last 12 hours":[r().subtract(3,"hours"),r()],"Last 24 hours":[r().subtract(3,"hours"),r()]}};if(e.prop("disabled"))e.daterangepicker(d),c=e.data("daterangepicker"),e.prop("disabled",!1),c.setStartDate(r.max(r.utc(i),r.utc(o).subtract(1,"day"))),c.setEndDate(r.utc(o));else{c=e.data("daterangepicker"),c.setOptions(d);var l=(new Date).getTimezoneOffset();a=c.startDate.subtract(l,"minutes"),n=c.endDate.subtract(l,"minutes"),c.setStartDate(r.max(r.utc(i),a)),c.setEndDate(r.min(r.utc(o),n))}},m)}}function u(){for(var e=0;e<arguments.length;e++)a(arguments[e])&&a(arguments[e]).find("option").remove();a("#time_start").val(""),a("#time_end").val("")}function f(){var t,r,n,o=a('[name="build"]').data(),s={},c=function(){return this.id};for(var d in o.inputs){switch(t=o.inputs[d],r=a("#"+t),t){case"service":case"offering":case"feature":case"property":n=r.find("option:selected").attr("id");break;case"features":case"properties":n=r.find("option:selected").map(c).get();break;case"time_start":n=a("#time_range").data("daterangepicker").startDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;case"time_end":n=a("#time_range").data("daterangepicker").endDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;default:n=r.val()}n&&(s[t]=n)}for(d in o.optionalInputs)t=o.optionalInputs[d],r=a("#"+t),n=r.val(),n&&(s[t]=n);var l=o.preferredSizes[a("#sizes").val()],p=a("#widget-container");p.draggable(),p.resizable("destroy"),a("#widget-container").width(l.w).height(l.h+39);var u=new e(o.name,s,v);p.resizable({helper:"ui-resizable-helper",resize:function(e,t){document.getElementById("embed").innerHTML=i(u.iframe(t.size.width,t.size.height-39))}}),document.getElementById("code").innerHTML=u.javascript(),document.getElementById("embed").innerHTML=i(u.iframe(l.w,l.h)),document.getElementById("link").innerHTML='<a href="'+u.url()+'" target="_blank">'+u.url()+"</a>"}function m(e,t,a){var r="";t&&(r="["+t+"] "),a&&a.request&&(r+=a.request+": "),e&&(r+=e),v.innerHTML='<div class="text-danger">'+r+"</div>"}function g(e){return e.toLowerCase().replace(/_/g," ").replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}n(),a(".panel").draggable({handle:".panel-heading"}),a(".width-resizable-panel").resizable({handles:"e, w"}),a("#widget-container").resizable();var v=document.getElementById("widget-view")}),require(["wizard"]);