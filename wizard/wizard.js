define("wizard",["SensorWidget","SOS","jquery","moment","errorhandler","daterangepicker","jquery-ui","bootstrap"],function(e,t,r,a,n){"use strict";function i(){var e=["bearing","gauge","jqgrid","map","panel","progressbar","table","thermometer","timechart","windrose"],t=["default","primary","success","info","warning","danger"],a="";for(var n in e){var i=e[n],o=t[n%t.length];a+='<a role="button" class="menu-btn btn btn-'+o+' btn-lg" id="'+i+'"><div class="flaticon-'+i+'"></div>'+g(i)+"&nbsp;&nbsp;»</a>"}document.getElementById("main-menu").innerHTML=a,r(".menu-btn").click(function(){s(this.id)})}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function s(t){r("#widget-form-title").html(g(t)+" Widget Configuration"),new e(t).inspect(function(e,a,i){var o,s,f,v,b="<fieldset><legend>Mandatory inputs</legend>";for(var h in e){switch(o=e[h],s="",f=g(o),v="",o){case"service":case"offering":case"feature":case"property":s='<select class="form-control" id="'+o+'"></select>';break;case"features":case"properties":s='<select class="form-control" multiple id="'+o+'"></select>',f+=" (multiselect)";break;case"refresh_interval":var y=[5,10,30,60,120];for(var w in y){var k=y[w];v+='<option id="'+k+'">'+k+"</option>"}s='<select class="form-control" id="'+o+'">'+v+"</select>";break;case"time_start":r.inArray("time_end",e)&&(f="Time Range (UTC)",s='<input class="form-control" type="text" id="time_range" disabled />');break;case"time_end":break;default:s='<input class="form-control" type="text" value="" id="'+o+'"/>'}s&&(b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+s+"</div></div>")}b+="</fieldset>",b+="<fieldset><legend>Optional inputs</legend>";for(h in a){switch(o=a[h],s="",f=g(o),v="",o){case"footnote":s='<textarea class="form-control" value="" id="'+o+'"></textarea>';break;case"base_map":for(var z in e.base_maps)v+='<option id="'+z+'">'+z+"</option>";s='<select class="form-control" id="'+o+'">'+v+"</select>";break;default:s='<textarea class="form-control" value="" id="'+o+'"></textarea>'}b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+s+"</div></div>"}b+="</fieldset>",b+="<fieldset><legend>Widget dimensions</legend>",o="sizes",f="Initial Size";for(h in i){var D=i[h];v+='<option id="size" value="'+h+'">'+D.w+" x "+D.h+" px</option>"}var T='<select class="form-control" id="sizes">'+v+"</select>";b+='<div class="form-group"><label class="col-lg-4 control-label" for="'+o+'">'+f+'</label><div class="col-lg-8">'+T+"</div></div>",b+="</fieldset>",b+='<input type="button" name="build" class="btn btn-primary pull-right" value="Create Widget&nbsp;&nbsp;»"/>',b+='<div id="builderError"  class="text-danger"></div>',r("#widget-form").html(b),r('[name="build"]').data({name:t,inputs:e,optionalInputs:a,preferredSizes:i}).click(m),c(["http://demo.geomati.co/sos/json","http://sensors.portdebarcelona.cat/sos/json","/52n-sos/sos/json"]),r("#service").change(function(){n.hideError();var e=r("#service").find("option:selected").attr("id");d(e)}),r("#offering").change(function(){var e=r("#offering").find("option:selected").data("procedure");p(e),l(e)}),r("#feature").change(function(){u()}),r("#features").change(function(){u()}),r("#property").change(function(){u()}),r("#properties").change(function(){u()})})}function c(e){var t=r("#service");if(e&&t){t.append(r("<option>").append("Select a Service..."));for(var a in e){var n=e[a];t.append(r("<option>").attr("id",n).append(n))}}}function d(e){f("#offering","#property","#properties","#feature","#features"),e&&(r("#offering").append(r("<option>").append("Select an Offering...")),t.setUrl(e),t.getCapabilities(function(e){for(var t in e){var a=e[t];r("#offering").append(r("<option>").attr("id",a.identifier).data("procedure",a.procedure[0]).append(a.name))}}))}function l(e){f("#property","#properties"),e&&t.describeSensor(e,function(e){var t=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;t=t instanceof Array?t:[t];for(var a in t){var n=t[a],i=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];for(var o in i){var s=i[o];n.hasOwnProperty(s)&&(n.type=s,n.id=n[s].definition,n.description=n.name+" ("+s,"Quantity"==s&&n[s].hasOwnProperty("uom")&&(n.description+=" ["+n[s].uom.code+"]"),n.description+=")")}r("#property, #properties").append(r("<option>").attr("id",n.id).append(n.description))}})}function p(e){f("#feature","#features"),e&&t.getFeatureOfInterest(e,function(e){for(var t in e){var a=e[t],n=a.identifier.value,i=a.name.value;r("#feature, #features").append(r("<option>").attr("id",n).append(i))}})}function u(){var e=r("#time_range");if(e.length){var n=r("#offering").find("option:selected").data("procedure"),i=r("#feature").find("option:selected").attr("id"),o=r("#property").find("option:selected").attr("id"),s=i?i:r("#features").find("option:selected").map(function(){return this.id}).get(),c=o?o:r("#properties").find("option:selected").map(function(){return this.id}).get();t.getDataAvailability(n,s,c,function(t){for(var r,n,i=t[0].phenomenonTime[0],o=t[0].phenomenonTime[1],s=1;s<t.length;s++)r=t[s].phenomenonTime[0],n=t[s].phenomenonTime[1],i>r&&(i=r),n>o&&(o=n);var c,d={timePicker:!0,format:"MMM D, YYYY H:mm",timePickerIncrement:5,timePicker12Hour:!1,timePickerSeconds:!1,timeZone:"+00:00",minDate:a.utc(i),maxDate:a.utc(o),dateLimit:{days:7},ranges:{Today:[a().startOf("day"),a()],"Last hour":[a().subtract(1,"hour"),a()],"Last 3 hours":[a().subtract(3,"hours"),a()],"Last 6 hours":[a().subtract(6,"hours"),a()],"Last 12 hours":[a().subtract(3,"hours"),a()],"Last 24 hours":[a().subtract(3,"hours"),a()]}};if(e.prop("disabled"))e.daterangepicker(d),c=e.data("daterangepicker"),e.prop("disabled",!1),c.setStartDate(a.max(a.utc(i),a.utc(o).subtract(1,"day"))),c.setEndDate(a.utc(o));else{c=e.data("daterangepicker"),c.setOptions(d);var l=(new Date).getTimezoneOffset();r=c.startDate.subtract(l,"minutes"),n=c.endDate.subtract(l,"minutes"),c.setStartDate(a.max(a.utc(i),r)),c.setEndDate(a.min(a.utc(o),n))}})}}function f(){for(var e=0;e<arguments.length;e++)r(arguments[e])&&r(arguments[e]).find("option").remove();r("#time_start").val(""),r("#time_end").val("")}function m(){var t,a,n,i=r('[name="build"]').data(),s={},c=function(){return this.id};for(var d in i.inputs){switch(t=i.inputs[d],a=r("#"+t),t){case"service":case"offering":case"feature":case"property":n=a.find("option:selected").attr("id");break;case"features":case"properties":n=a.find("option:selected").map(c).get();break;case"time_start":n=r("#time_range").data("daterangepicker").startDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;case"time_end":n=r("#time_range").data("daterangepicker").endDate.utc().format("YYYY-MM-DD[T]HH:mm:ss[Z]");break;default:n=a.val()}n&&(s[t]=n)}for(d in i.optionalInputs)t=i.optionalInputs[d],a=r("#"+t),n=a.val(),n&&(s[t]=n);var l=i.preferredSizes[r("#sizes").val()],p=r("#widget-container");p.draggable(),p.resizable("destroy"),r("#widget-container").width(l.w).height(l.h+39);var u=new e(i.name,s,document.getElementById("widget-view"));p.resizable({helper:"ui-resizable-helper",resize:function(e,t){document.getElementById("embed").innerHTML=o(u.iframe(t.size.width,t.size.height-39))}}),document.getElementById("code").innerHTML=u.javascript(),document.getElementById("embed").innerHTML=o(u.iframe(l.w,l.h)),document.getElementById("link").innerHTML='<a href="'+u.url()+'" target="_blank">'+u.url()+"</a>"}function g(e){return e.toLowerCase().replace(/_/g," ").replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})}i(),r(".panel").draggable({handle:".panel-heading"}),r(".width-resizable-panel").resizable({handles:"e, w"}),r("#widget-container").resizable()}),require(["wizard"]);