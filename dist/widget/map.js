define(["SOS","leaflet","proj4","proj4leaflet","leaflet-label"],function(e,t,r){r.defs("EPSG:23031","+title= ED50 / UTM zone 31N +proj=utm +zone=31 +ellps=intl +units=m +no_defs +towgs84=-181.5,-90.3,-187.2,0.144,0.492,-0.394,17.57");var o=["service","offering","features","maxInitialZoom"];return{inputs:o,init:function(r,o){function a(){e.getCapabilities(function(o){var a=function(e){var o=t.Proj.geoJson(s(e),{onEachFeature:function(e,t){e.properties&&e.properties.name&&t.bindLabel(e.properties.name).addTo(p)}});o.addTo(p),p.fitBounds(o.getBounds(),{maxZoom:r.maxInitialZoom?parseInt(r.maxInitialZoom):14})};for(var n in o){var i=o[n];i.identifier==r.offering&&e.getFeatureOfInterest(i.procedure[0],a)}})}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e,t){return t.indexOf(e)>-1}function s(e){var t=n(r.features)?r.features:JSON.parse(r.features),o=[];for(var a in e){var s=e[a];if(s.geometry&&(!t.length||i(s.identifier.value,r.features))){var p={type:"Feature",geometry:s.geometry,id:s.identifier.value,properties:{name:s.name.value}};if(p.geometry.crs){var l=p.geometry.crs;if("link"==l.type){var f=l.properties.href.split("/").pop();delete p.geometry.crs,delete l.properties.href,l.type="name",l.properties.name="EPSG:"+f,p.crs=l}}o.push(p)}}return{type:"FeatureCollection",features:o}}var p=t.map(o,{dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,zoomControl:!1}).setView([30,0],2);t.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",{subdomains:"1234",minZoom:2,maxZoom:14,attribution:'<a href="http://www.openstreetmap.org" target="_blank">OpenStreetMap</a> | <a href="http://www.mapquest.com" target="_blank">MapQuest</a>'}).addTo(p),e.setUrl(r.service),a()}}});