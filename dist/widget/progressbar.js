define(["SOS","css!widget/progressbar.css","widget/common"],function(e,t,r){var n=["service","offering","feature","property","min_value","max_value","refresh_interval"];return{inputs:n,init:function(t,n){function i(){e.getObservation(t.offering,[t.feature],[t.property],"latest",a)}function a(n){if(1==n.length&&"number"==typeof n[0].result.value){var i=n[0],a=i.featureOfInterest.name.value,u=new Date(i.resultTime);value=i.result.value,procedure=i.procedure;var d=100*(value-t.min_value)/(t.max_value-t.min_value);document.getElementById("feature_name").innerHTML=a,document.getElementById("date").innerHTML=r.date.display(u),document.getElementById("value").innerHTML=value,document.getElementById("bar").style="width: "+d+"%",e.describeSensor(i.procedure,function(e){var r=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;for(var n in r){var i=r[n];i.Quantity.definition==t.property&&(document.getElementById("property_name").innerHTML=i.name)}})}else console.error("Progress Widget Error - Got an invalid observation from the SOS service")}var u='<div class="widget">';u+='<h1 id="feature_name"></h1><h3 id="property_name"></h3>',u+='<div class="progress"><span id="bar" class="blue"><div id="value"></div></span><div id="min">0</div><div id="max">100</div></div>',u+='<h3 id="date"></h3></div>',n.innerHTML=u,document.getElementById("min").innerHTML=t.min_value,document.getElementById("max").innerHTML=t.max_value,e.setUrl(t.service),setInterval(i,1e3*t.refresh_interval),i()}}});