define(["SOS","widget/common","flot-resize","flot-time","flot-tooltip","flot-navigate"],function(e,t){var r=["title","service","offering","features","properties","time_start","time_end"],o=null;return{inputs:r,init:function(r,i){function a(){var t=n(r.features)?r.features:JSON.parse(r.features),o=n(r.properties)?r.properties:JSON.parse(r.properties),i=r.time_start&&r.time_end?[r.time_start,r.time_end]:null;e.getObservation(r.offering,t,o,i,s)}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e){var t=[];for(var r in e){var i=e[r],a=i.result;t.push({feature:i.featureOfInterest.name.value,property:i.observableProperty,time:new Date(i.resultTime).getTime(),value:a.hasOwnProperty("value")?a.value:a,uom:a.hasOwnProperty("uom")?a.uom:"(N/A)"})}o?p(t):e.length&&u(e[0].procedure,t)}function u(t,r){e.describeSensor(t,function(e){var t=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;t=t instanceof Array?t:[t];var i=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];o=[];for(var a in t){var n=t[a];for(var s in i){var u=i[s];n.hasOwnProperty(u)&&(n.id=n[u].definition)}o[n.id]=n.name}p(r)})}function p(e){var a={};for(var n in e){var s=e[n],u=o[s.property]+" ("+s.feature+")";a[u]||(a[u]={data:[]}),a[u].data.push([s.time,s.value])}var p=[];for(var l in a)a[l].label=l,p.push(a[l]);var v=function(e,t){return t[0]-e[0]};for(var f in p)a=p[f],a.data.sort(v);var c={xaxis:{mode:"time",timezone:t.date.utc()?"UTC":"browser"},yaxis:{zoomRange:!1,panRange:!1},grid:{hoverable:!0},series:{lines:{show:!0},points:{show:!0}},tooltip:!0,tooltipOpts:{content:"[%x] %s: %y.2 "+e[0].uom},zoom:{interactive:!0},pan:{interactive:!0}},m='<div class="timechart widget">';m+=r.title?'<h3 class="title">'+r.title+"</h3>":"",m+="<div class='graph' style='height:100%;'></div>",m+="</div>",i.innerHTML=m;var d=i.querySelector(".graph");$.plot(d,p,c)}e.setUrl(r.service),a()}}});