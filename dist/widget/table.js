define(["SOS","widget/common"],function(e,t){var r=["title","service","offering","feature","properties","time_start","time_end"],a=null;return{inputs:r,init:function(r,i){function n(){var t=r.properties=o(r.properties)?r.properties:JSON.parse(r.properties),a=r.time_start&&r.time_end?[r.time_start,r.time_end]:null;e.getObservation(r.offering,[r.feature],t,a,s)}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e){var t={};for(var r in e){var a=e[r],i=new Date(a.resultTime).getTime(),n=a.observableProperty,o=a.result.hasOwnProperty("value")?a.result.value:a.result;t[i]||(t[i]={}),t[i][n]=o}e.length&&l(e[0].procedure,t)}function l(t,i){e.describeSensor(t,function(e){function t(e,t){return t.indexOf(e)>-1}var n=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;n=n instanceof Array?n:[n];var o=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];a={};for(var s in n){var l=n[s];for(var u in o){var b=o[u];l.hasOwnProperty(b)&&(l.id=l[b].definition)}t(l.id,r.properties)&&(a[l.id]=l.name)}p(i,a)})}function p(e,a){table='<div class="table-responsive">',table+='<table class="table table-striped table-condensed table-hover table-bordered">',table+="<tr>",table+="<thead>",table+="<th>Result Time</th>";for(var n in r.properties)table+="<th>"+a[r.properties[n]]+"</th>";table+="</tr>",table+="</thead>";var o=Object.keys(e);o.sort().reverse();for(n in o){var s=o[n],l=e[s];table+="<tr>",table+='<th class="time">'+t.date.display(new Date(parseInt(s)))+"</th>";for(var p in r.properties)table+="<td>"+l[r.properties[p]]+"</td>";table+="</tr>"}table+="</table>",table+="</div>";var u=r.title?"<h3>"+r.title+"</h3>":"";i.innerHTML=u+table}e.setUrl(r.service),n()}}});