define(["SOS","widget/common"],function(e,r){var t=["title","service","offering","feature","properties","refresh_interval"];return{inputs:t,init:function(t,o){function i(){var r="<h2>"+t.title+"</h2>",i="<h3>Loading...</h3>";o.innerHTML=r+i,t.properties=!t.properties|!t.properties.length?null:n(t.properties)?t.properties:JSON.parse(t.properties),e.getObservation(t.offering,[t.feature],t.properties,"latest",a)}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function a(e){var r=[];for(var i in e){var n=e[i],a=new Date(n.resultTime),s=n.result;r[n.observableProperty]={time:a,feature:n.featureOfInterest.name.value,property:n.observableProperty,value:s.hasOwnProperty("value")?s.value:s,uom:s.hasOwnProperty("uom")?s.uom:"(N/A)"}}if(e.length)p(e[0].procedure,r);else{var u="<h2>"+t.title+"</h2>",l="<h3>(no data)</h3>";o.innerHTML=u+l}}function p(r,o){e.describeSensor(r,function(e){var r=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;r=r instanceof Array?r:[r];var i=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];propertyNames=[];for(var n in r){var a=r[n];for(var p in i){var u=i[p];a.hasOwnProperty(u)&&(a.id=a[u].definition)}propertyNames[a.id]=a.name}t.properties||(t.properties=Object.keys(propertyNames)),s(o,propertyNames)})}function s(e,i){var n="<h2>"+t.title+"</h2>";n+="<h3>"+r.date.display(e[Object.keys(e)[0]].time)+"</h3>";var a='<dl class="dl-horizontal">';for(var p in t.properties){var s=e[t.properties[p]];s&&(a+="<dt>"+i[s.property]+"</dt>",a+="<dd>"+s.value+" "+s.uom+"</dd>")}a+="</dl>",o.innerHTML=n+a}e.setUrl(t.service),setInterval(i,1e3*t.refresh_interval),i()}}});