define(["SOS","widget/common","jqgrid","css!widget/table.css"],function(e,t){var r=["title","service","offering","features","properties","time_start","time_end"],i=null;return{inputs:r,init:function(r,a){function n(){var t=o(r.features)?r.features:JSON.parse(r.features),i=o(r.properties)?r.properties:JSON.parse(r.properties),a=r.time_start&&r.time_end?[r.time_start,r.time_end]:null;e.getObservation(r.offering,t,i,a,u)}function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e){var t=[];for(var r in e){var a=e[r],n=new Date(a.resultTime),o=a.result;t.push({time:n,feature:a.featureOfInterest.name.value,property:a.observableProperty,value:o.hasOwnProperty("value")?o.value:o,uom:o.hasOwnProperty("uom")?o.uom:"(N/A)"})}i?d(t):e.length&&s(e[0].procedure,t)}function s(t,r){e.describeSensor(t,function(e){var t=e.hasOwnProperty("ProcessModel")?e.ProcessModel.outputs.OutputList.output:e.System.outputs.OutputList.output;t=t instanceof Array?t:[t];var a=["Quantity","Count","Boolean","Category","Text","ObservableProperty"];i=[];for(var n in t){var o=t[n];for(var u in a){var s=a[u];o.hasOwnProperty(s)&&(o.id=o[s].definition)}i[o.id]=o.name}d(r)})}function d(e){for(var n in e){var o=e[n];i[o.property]&&(o.property=i[o.property])}var u=r.title?"<h3>"+r.title+"</h3>":"",s="<table id='grid'></table>",d='<div id="pager"></div>';a.innerHTML=u+s+d,jQuery("#grid").jqGrid({datatype:"local",height:"auto",width:"100%",caption:"Results",data:e,pager:"#pager",rowNum:12,sortname:"time",autowidth:!0,colNames:["Time","Feature","Property","Value","Unit"],colModel:[{name:"time",index:"time",width:"160",formatter:function(e){var r=t.date.display(e);return r}},{name:"feature",index:"feature",width:"150"},{name:"property",index:"property",width:"150"},{name:"value",index:"value",width:"80",align:"right"},{name:"uom",index:"uom",width:"60"}]}),$("#grid").setGridWidth($(window).width()-2),$(window).bind("resize",function(){$("#grid").setGridWidth($(window).width()-2)})}e.setUrl(r.service),n()}}});