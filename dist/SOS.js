define(["XML"],function(e){return SOS={_url:null,setUrl:function(e){this._url=e},getCapabilities:function(e){var t={request:"GetCapabilities",sections:["Contents"]};this._send(t,function(t){e(t.contents)})},describeSensor:function(t,r){var n={request:"DescribeSensor",procedure:t,procedureDescriptionFormat:"http://www.opengis.net/sensorML/1.0.1"};this._send(n,function(t){var n=t.procedureDescription.description,i=e.read(n,!0);r(i.SensorML.member)})},getFeatureOfInterest:function(e,t){var r={request:"GetFeatureOfInterest",procedure:e};this._send(r,function(e){t(e.featureOfInterest)})},getDataAvailability:function(e,t,r,n){var i={request:"GetDataAvailability"};e&&(i.procedures=e),t&&(i.features=t),r&&(i.properties=r),this._send(i,function(e){n(e.dataAvailability)})},getObservation:function(e,t,r,n,i){var s={request:"GetObservation"};if(e&&(s.offering=e),t&&t.length&&(s.featureOfInterest=t),r&&r.length&&(s.observedProperty=r),n){var o;o=n.length&&2==n.length?"during":"equals",filter={},filter[o]={ref:"om:resultTime",value:n},s.temporalFilter=[filter]}this._send(s,function(e){i(e.observations)})},_send:function(e,t){e.service="SOS",e.version="2.0.0";var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){var e=JSON.parse(r.responseText);t.call(this,e)}else console.error("Error accessing "+this._url)}.bind(this),r.open("POST",this._url,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.send(JSON.stringify(e))}}});