/* This work is licensed under Creative Commons GNU LGPL License.

 License: http://creativecommons.org/licenses/LGPL/2.1/
 Version: 0.9
 Author:  Stefan Goessner/2006
 See:     http://goessner.net/download/prj/jsonxml/
 */

define([],function(){return{read:function(e,n){var t={at:n?"":"@",toObj:function(e){var r={};if(1==e.nodeType){if(e.attributes.length)for(var i=0;i<e.attributes.length;i++){var a=e.attributes[i].name,o=e.attributes[i].value,l=0===a.lastIndexOf("xmlns:",0);n&&l||(r[t.at+a]=(o||"").toString())}if(e.firstChild){for(var f=0,d=0,s=!1,u=e.firstChild;u;u=u.nextSibling)1==u.nodeType?s=!0:3==u.nodeType&&u.nodeValue.match(/[^ \f\n\r\t\v]/)?f++:4==u.nodeType&&d++;if(s)if(2>f&&2>d)for(t.removeWhite(e),u=e.firstChild;u;u=u.nextSibling)3==u.nodeType?r["#text"]=t.escape(u.nodeValue):4==u.nodeType?r["#cdata"]=t.escape(u.nodeValue):r[u.nodeName]?r[u.nodeName]instanceof Array?r[u.nodeName][r[u.nodeName].length]=t.toObj(u):r[u.nodeName]=[r[u.nodeName],t.toObj(u)]:r[u.nodeName]=t.toObj(u);else e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(f)e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(d)if(d>1)r=t.escape(t.innerXml(e));else for(u=e.firstChild;u;u=u.nextSibling)r["#cdata"]=t.escape(u.nodeValue)}e.attributes.length||e.firstChild||(r=null)}else if(9==e.nodeType)r=t.toObj(e.documentElement);else{if(8==e.nodeType)return e.data;console.error("unhandled node type: "+e.nodeType)}return r},innerXml:function(e){var n="";if("innerHTML"in e)n=e.innerHTML;else for(var t=function(e){var n="";if(1==e.nodeType){n+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++){var i=e.attributes[r].name,a=e.attributes[r].value||"";n+=" "+i+'="'+a.toString()+'"'}if(e.firstChild){n+=">";for(var o=e.firstChild;o;o=o.nextSibling)n+=t(o);n+="</"+e.nodeName+">"}else n+="/>"}else 3==e.nodeType?n+=e.nodeValue:4==e.nodeType&&(n+="<![CDATA["+e.nodeValue+"]]>");return n},r=e.firstChild;r;r=r.nextSibling)n+=t(r);return n},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var r=n.nextSibling;e.removeChild(n),n=r}else 1==n.nodeType?(t.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e}};n&&(e=e.replace(/<(\/?)([^:>\s]*:)?([^>]+)>/g,"<$1$3>")),e=(new DOMParser).parseFromString(e,"text/xml"),9==e.nodeType&&(e=e.documentElement);var r={};return r[e.nodeName]=t.toObj(t.removeWhite(e)),r},write:function(e){var n=function(e,t,r){var i="";if(e instanceof Array)for(var a=0,o=e.length;o>a;a++)i+=r+n(e[a],t,r+"	")+"\n";else if("object"==typeof e){var l=!1;i+=r+"<"+t;for(var f in e)"@"==f.charAt(0)?i+=" "+f.substr(1)+'="'+e[f].toString()+'"':l=!0;if(i+=l?">":"/>",l){for(f in e)"#text"==f?i+=e[f]:"#cdata"==f?i+="<![CDATA["+e[f]+"]]>":"@"!=f.charAt(0)&&(i+=n(e[f],f,r+"	"));i+=("\n"==i.charAt(i.length-1)?r:"")+"</"+t+">"}}else i+=r+"<"+t+">"+e.toString()+"</"+t+">";return i},t="";for(var r in e)t+=n(e[r],r,"");return t}}});