define("SensorWidget",["errorhandler"],function(e){"use strict";function t(e,t){return e.replace(/^(?=.)/gm,new Array(t+1).join(" "))}function r(t,r,n,i){var o=[];for(var a in r){var s=r[a];n.hasOwnProperty(s)||o.push(s)}return o.length&&e.throwWidgetError("The '"+t+"' widget is missing some mandatory parameters: "+o.join(", "),i),!o.length}var n={},i=function(e){return function(){return"SensorWidgetTarget-"+ ++e}}(0);return function(o,a,s){s||(s=document.body);var u=s;return o&&a?(s.id||(s.id=i()),a.service||(a.service="/52n-sos/sos/json"),require(["widget/"+o],function(e){s.innerHTML="",n.hasOwnProperty(s.id)&&n[s.id]&&n[s.id].hasOwnProperty("destroy")&&(console.debug("Destroying previous widget on ElementId="+s.id),n[s.id].destroy(),delete n[s.id]),r(o,e.inputs,a,u)&&(console.debug("Creating new "+o+" widget on ElementId="+s.id),n[s.id]=e.init(a,s))},function(){e.throwWidgetError("Widget '"+o+"' cannot be found.",u)})):o||e.throwWidgetError("No widget name specified.",u),{name:o,config:a,renderTo:s,inspect:function(e){require(["widget/"+o],function(t){e.call(this,t.inputs,t.optional_inputs,t.preferredSizes)})},url:function(){function e(e){var t=[];return e.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(e){"/.."===e?t.pop():t.push(e)}),t.join("").replace(/^\//,"/"===e.charAt(0)?"/":"")}var t=e(require.toUrl("../widget/"))+"?";return t+="name="+encodeURIComponent(o)+"&",t+=Object.keys(a).map(function(e){var t=a[e];return"object"==typeof a[e]&&(t=JSON.stringify(a[e])),e+"="+encodeURIComponent(t)}).join("&")},iframe:function(e,t){return e=e?e:"100%",t=t?t:"100%",'<iframe src="'+this.url()+'" width="'+e+'" height="'+t+'" frameBorder="0"></iframe>'},javascript:function(){var e="SensorWidget('"+o+"', "+JSON.stringify(a,null,3)+",\r\ndocument.getElementById('"+o+"-container'));\r\n";return"require(['SensorWidget'], function(SensorWidget) {\r\n"+t(e,3)+"});"}}}}),define("widget/map",["SOS","leaflet","SensorWidget","widget-common","leaflet-label"],function(e,t,r,n){"use strict";return{inputs:n.inputs.concat(["features"]),optional_inputs:["max_initial_zoom","base_layer"].concat(n.optional_inputs),preferredSizes:[{w:550,h:400}],init:function(r,i){function o(){e.getCapabilities(function(n){function i(e){var n=t.geoJson(u(e));n.addTo(f),f.fitBounds(n.getBounds(),{maxZoom:r.max_initial_zoom?parseInt(r.max_initial_zoom):14})}for(var o in n){var a=n[o];a.identifier==r.offering&&e.getFeatureOfInterest(a.procedure[0],i)}})}function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function s(e,t){return t.indexOf(e)>-1}function u(e){var t=a(r.features)?r.features:JSON.parse(r.features),n=[];for(var i in e){var o=e[i];if(o.geometry&&(!t.length||s(o.identifier.value,r.features))){var u={type:"Feature",geometry:o.geometry,id:o.identifier.value,properties:{name:o.name.value}};n.push(u)}}var c={type:"FeatureCollection",features:n};return c}var c=document.createElement("div");c.className="map widget",i.appendChild(c),n.init(r,i);var d;if(r.base_layer){var p="string"==typeof r.base_layer||r.base_layer instanceof String?JSON.parse(r.base_layer):r.base_layer;d=p.type&&"WMS"===p.type.toUpperCase()?t.tileLayer.wms(p.url,p.options):t.tileLayer(p.url,p.options)}else d=t.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19});r.footnote&&(d.options.attribution+=" | <b>"+r.footnote+"</b>");var f=t.map(c,{layers:[d]});e.setUrl(r.service),o()}}});